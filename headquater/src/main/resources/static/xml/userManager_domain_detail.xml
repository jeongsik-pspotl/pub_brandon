<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
    	<w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data xmlns=""/>
            </xf:instance>
            <w2:dataCollection baseNode="map">
				<w2:dataList id="dlt_rolecode_list_selectbox" saveRemovedData="true" style="">
					<w2:columnInfo>
						<w2:column dataType="text" id="role_code_id" name="name1"></w2:column>
						<w2:column dataType="text" id="role_code_name" name="name2"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList id="__workspace_save_setting_data__" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="domain_id" name="domain_id" dataType="text"></w2:column>
						<w2:column id="domain_name" name="domain_name" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection>
            </w2:workflowCollection>
        </xf:model>
         <script type="text/javascript" lazy="false">
			 <![CDATA[
			 scwin.domainCheckYn = false;
			 scwin.onpageload = function() {

				var domain_setting_mode = localStorage.getItem("_domain_setting_mode_");

				if (domain_setting_mode == "detailview"){
					var view = common.getLabel("lbl_userManager_domain_detail_domainView");
					var save = common.getLabel("lbl_save");
					domain_setting_title.setLabel(view);
					domain_create_or_save_btn.setLabel(save);
					// setDisabled
					// manager_domain_name.setDisabled(true);
					//member_role.setDisabled(true);
					domain_created_date.setDisabled(true);
					domain_updated_date.setDisabled(true);

					scwin.domainDetailView();
				}else {
					var view = common.getLabel("lbl_userManager_domain_detail_domainView");
					var create = common.getLabel("lbl_create");
					domain_setting_title.setLabel(view);
					domain_create_or_save_btn.setLabel(create);

					domain_created_date.setDisabled(true);
					domain_updated_date.setDisabled(true);

				}

			};
	
	scwin.onpageunload = function() {

	};

	scwin.checkData = function() {

		var domain_name = manager_domain_name.getValue();

		if(common.isEmptyStr(domain_name)){
			var message = common.getLabel("lbl_userManager_domain_detail_blank");
		    alert(message);
			return false;
		}

		if(common.checkAllInputText("CHECK_INPUT_TYPE_SPC",domain_name)){
			var message = common.getLabel("lbl_can_not_special_char");
			alert(message);
			return false;
		}

		if(!scwin.domainCheckYn){
			var message = common.getLabel("lbl_userManager_domain_detail_buttonClick");
			alert(message);
			return false;
		}

		return true;
	};

	scwin.domainDetailView = function(){

		var domain_id = localStorage.getItem("_domain_id_");

		var options = {};

		options.action = "/manager/domain/search/domain/" + parseInt(domain_id);
		options.mode = "asynchronous";
		options.mediatype = "application/json";
		options.method = "GET";

		options.success = function (e) {
			var data = e.responseJSON;
			if (data != null) {

				var create_date = "";
				var updated_date = "";
				// console.log(data);
				if(data.create_date != null){
					create_date = data.create_date.replace(/T/g,' ');
				}

				if (data.updated_date != null){
					updated_date = data.updated_date.replace(/T/g,' ');

				}
			    
				manager_domain_name.setValue(data.domain_name);
				domain_created_date.setValue(create_date);
				domain_updated_date.setValue(updated_date);

			} else {

			}
		};

		options.error = function (e) {
			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n");

		};

		$p.ajax( options );


	};

	scwin.select_check_domain_name = function(domain_name){
		var options = {};

		options.action = "/manager/domain/search/checkName/" + domain_name;
		options.mode = "asynchronous";
		options.mediatype = "application/json";
		options.method = "GET";

		options.success = function (e) {
			var data = e.responseJSON;
			if (e.responseStatusCode === 200 || e.responseStatusCode === 201) {

				if(data[0].domain_name_not_found == "no"){
					var message = common.getLabel("lbl_exist_name");
					alert(message);
				}else if(data[0].domain_name_not_found == "yes"){
					var message = common.getLabel("lbl_can_use_name");
					alert(message);
					scwin.domainCheckYn = true;
				}

			}

		};

		options.error = function (e) {
			if(e.responseStatusCode === 500){
				// alert(" 해당 이름은 사용 가능 합니다.");

			}else {
				alert( "message:"+e.responseText+"\n" );
			}

		};

		$p.ajax( options );

	};

	scwin.setDomainCreateAndInsert = function (domain_detail_data) {

	    var domain_detail_json = {};
		domain_detail_json = domain_detail_data;

	    var options = {};
	    options.action = "/manager/domain/create";
	    options.mode = "asynchronous";
	    options.mediatype = "application/json";
	    options.requestData = JSON.stringify(domain_detail_json);
	    options.method = "POST";

	    options.success = function (e) {
	        var data = e.responseJSON;
	        if ((e.responseStatusCode === 200 || e.responseStatusCode === 201)&& data != null) {
				var message = common.getLabel("lbl_userManager_domain_detail_success");
	            alert(message);
	            $p.parent().wfm_main.setSrc("/xml/userManager.xml");
	        } else {
				var message = common.getLabel("lbl_userManager_domain_detail_fail");
	            alert(message);
	        }
	    };

	    options.error = function (e) {
	        alert( "message:"+e.responseText+"\n");
	    };

	    $p.ajax( options );
	};

	scwin.setDomainNameUpdate = function (domain_id, domain_name) {

		var workspace_update_data = {};
        var data = {};

		workspace_update_data.domain_id = domain_id;
		workspace_update_data.domain_name = domain_name;

        data.domain_id = domain_id;
        data.domain_name = domain_name;

		var options = {};

		options.action = "/manager/domain/update";
		options.mode = "asynchronous";
		options.mediatype = "application/json";
		options.method = "POST";
        options.requestData = JSON.stringify(data);

		options.success = function (e) {
			var data = e.responseJSON;
			if ((e.responseStatusCode === 200 || e.responseStatusCode === 201) && data != null) {
				var message = common.getLabel("lbl_userManager_domain_detail_modifiedSuccess");
				alert(message);
				$p.parent().wfm_main.setSrc("/xml/userManager.xml");
			} else {
				var message = common.getLabel("lbl_userManager_domain_detail_modifiedFail");
				alert(message);
			}
		};

		options.error = function (e) {
			alert( "message:"+e.responseText+"\n");

		};

		$p.ajax( options );


	};

	scwin.btn_update_workspace_detail_onclick = function(e){

		var viewType = localStorage.getItem("_domain_setting_mode_");

		if(viewType == "detailview"){

			var data = {};
			data.domain_name = manager_domain_name.getValue(); // 신중히 validation 처리 기능 구현하기
			var domain_id = localStorage.getItem("_domain_id_");

			scwin.setDomainNameUpdate(domain_id, data.domain_name);
		}else {
			if(scwin.checkData()){

				var data = {};
				data.domain_name = manager_domain_name.getValue(); // 신중히 validation 처리 기능 구현하기

				scwin.setDomainCreateAndInsert(data); // create or update 분기 처리 필요.

			}

		}

	};

	scwin.step1_select_platform_onchange = function(e){
		var platform = this.getValue(this.getSelectedIndex);
		localStorage.setItem("_role_code_id_",platform);
	};



	scwin.step1_btn_check_domain_onclick = function(e){

		var domain_name = manager_domain_name.getValue();

		if(common.isEmptyStr(domain_name)){
			var message = common.getLabel("lbl_userManager_domain_detail_blank");
			alert(message);
			return false;
		}

		if(common.checkAllInputText("CHECK_INPUT_TYPE_SPC",domain_name)){
			var message = common.getLabel("lbl_can_not_special_char");
			alert(message);
			return false;
		}

		scwin.select_check_domain_name(domain_name);

	};
			 ]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
    	<xf:group class="gallery_box" id="" style="">
			<xf:group class="dfbox" id="" style="">
				<xf:group class="fl">
					<w2:textbox class="gal_tit fl" id="domain_setting_title" label="" style="" useLocale="true" localeRef="lbl_userManager_domain_detail_domainView"></w2:textbox>
				</xf:group>
				<xf:group class="fr">
					<xf:trigger class="btn_cm type1 fl" id="domain_create_or_save_btn" style="" type="button" ev:onclick="scwin.btn_update_workspace_detail_onclick" useLocale="true" localeRef="lbl_modify">
						<xf:label><![CDATA[]]></xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
    		<xf:group class="gal_body" id="" style="">
    			<xf:group id="" style="" class="form_wrap">
					<xf:group id="" style="" class="" tagname="ul">
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_userManager_domain_detail_domainName"></w2:textbox>
							<xf:group class="ipt_box" id="" style="">
								<xf:input id="manager_domain_name" style="" adjustMaxLength="false"></xf:input>
								<xf:trigger id="" style="" class="btn_cm" type="button" ev:onclick="scwin.step1_btn_check_domain_onclick" useLocale="true" localeRef="lbl_dup_check">
									<xf:label><![CDATA[]]></xf:label>
								</xf:trigger>
							</xf:group>
						</xf:group>
						<!-- 중복 확인 기능 추가 ... -->
						<!-- -->
<!--						<xf:group id="" style="" class="" tagname="li">-->
<!--							<w2:textbox id="" style="" class="form_name" label="Workspace 사용자 권한"></w2:textbox>-->
<!--							<xf:select1 renderType="native" id="user_select_rolecode_settingbox" disabledClass="w2selectbox_disabled" ref="" appearance="minimal" style="" direction="auto" chooseOption="" displayMode="label" allOption="" submenuSize="auto" disabled="false" >-->
<!--								<xf:choices>-->
<!--									<xf:item>-->
<!--										<xf:label><![CDATA[ADMIN]]></xf:label>-->
<!--										<xf:value><![CDATA[11]]></xf:value>-->
<!--									</xf:item>-->
<!--									<xf:item>-->
<!--										<xf:label><![CDATA[USER]]></xf:label>-->
<!--										<xf:value><![CDATA[12]]></xf:value>-->
<!--									</xf:item>-->
<!--								</xf:choices>-->
<!--							</xf:select1>-->
<!--						</xf:group>-->
						<xf:group id="grp_user_craete_date" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_created_date"></w2:textbox>
							<xf:input id="domain_created_date" style="" adjustMaxLength="false"></xf:input>
						</xf:group>
						<xf:group id="grp_user_update_date" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_modified_date"></w2:textbox>
							<xf:input id="domain_updated_date" style="" adjustMaxLength="false"></xf:input>
						</xf:group>
    				</xf:group>
				</xf:group>
			</xf:group>
    	</xf:group>
    </body>
</html>
