<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ev="http://www.w3.org/2001/xml-events"
	  xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate/>
		<xf:model>
			<xf:instance>
				<data xmlns=""/>
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="__ftp_setting_detail_data__" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="ftp_id" name="ftp_id" dataType="text"></w2:column>
						<w2:column id="ftp_name" name="ftp_name" dataType="text"></w2:column>
						<w2:column id="ftp_url" name="ftp_url" dataType="text"></w2:column>
						<w2:column id="ftp_type" name="ftp_type" dataType="text"></w2:column>
						<w2:column id="ftp_etc1" name="ftp_etc1" dataType="text"></w2:column>
						<w2:column id="ftp_etc2" name="ftp_etc2" dataType="text"></w2:column>
						<w2:column id="create_date" name="create_date" dataType="text"></w2:column>
						<w2:column id="update_date" name="update_date" dataType="text"></w2:column>
						<w2:column id="ftp_ip" name="ftp_ip" dataType="text"></w2:column>
						<w2:column id="ftp_port" name="ftp_port" dataType="text"></w2:column>
						<w2:column id="ftp_user_id" name="ftp_user_id" dataType="text"></w2:column>
						<w2:column id="ftp_user_pwd" name="ftp_user_pwd" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
		</xf:model>
		<script type="text/javascript" lazy="false">
			 <![CDATA[
			scwin.check_FTP_name_yn = false;
			scwin.onpageload = function() {
				// 화면 구성 변경
				var ftp_setting_mode = localStorage.getItem("_ftp_setting_mode_");

				if (ftp_setting_mode == "detailview"){
					var view = common.getLabel("lbl_setting_ftp_detail_detailView");
					var save = common.getLabel("lbl_save");

					ftp_setting_title.setLabel(view);
					ftp_create_or_save_btn.setLabel(save);
					// setDisabled
					// ftp_setting_role_id.setDisabled(true);
					ftp_setting_name.setDisabled(true);
					ftp_setting_url.setDisabled(false);
					ftp_setting_ip.setDisabled(false);
					ftp_setting_port.setDisabled(false);
					ftp_setting_user_id.setDisabled(false);
					ftp_setting_user_pwd.setDisabled(false);

					scwin.ftpDetailView();
				}else {
					var view = common.getLabel("lbl_setting_ftp_detail_createView");
					var create = common.getLabel("lbl_create");

					ftp_setting_title.setLabel(view);
					ftp_create_or_save_btn.setLabel(create);
					// ftp_setting_role_id.setDisabled(false);
					ftp_setting_name.setDisabled(false);
					ftp_setting_url.setDisabled(false);
					ftp_setting_ip.setDisabled(false);
					ftp_setting_port.setDisabled(false);
					ftp_setting_user_id.setDisabled(false);
					ftp_setting_user_pwd.setDisabled(false);
				}

			};

			scwin.onpageunload = function() {

			};

			scwin.checkData = function() {

				var ftp_name = ftp_setting_name.getValue();
				var ftp_server_url = ftp_setting_url.getValue();
				var ftp_server_ip = ftp_setting_ip.getValue();
				var ftp_server_port = ftp_setting_port.getValue();
				var ftp_user_id = ftp_setting_user_id.getValue();
				var ftp_user_pwd = ftp_setting_user_pwd.getValue();

				var project_name_check_str = common.checkAllInputText("CHECK_INPUT_TYPE_PROJECT_NAME",ftp_name);
				// var build_server_url_check_str = common.checkAllInputText("CHECK_INPUT_TYPE_IP_PORT",build_server_url);

				if(common.isEmptyStr(ftp_name)){
					var message = common.getLabel("lbl_setting_ftp_detail_inputName");
					alert(message);
					return false;
				}

				var ftp_setting_mode = localStorage.getItem("_ftp_setting_mode_");

				if(!scwin.check_FTP_name_yn && !(ftp_setting_mode == "detailview")){
					var message = common.getLabel("lbl_setting_ftp_detail_nameCheck");
				    alert(message);
				    return false;

				}

				if(ftp_server_url == ""){
					var message = common.getLabel("lbl_setting_ftp_detail_urlInput");
					alert(message);
				    return false;
				}

				if(ftp_server_ip == ""){
					var message = common.getLabel("lbl_setting_ftp_detail_ipInput");
					alert(message);
					return false;
				}

				if(ftp_server_port == ""){
					var message = common.getLabel("lbl_setting_ftp_detail_portInput");
					alert(message);
					return false;
				}

				if(ftp_user_id == ""){
					var message = common.getLabel("lbl_setting_ftp_detail_idInput");
					alert(message);
					return false;
				}

				if(ftp_user_pwd == ""){
					var message = common.getLabel("lbl_setting_ftp_detail_pwdInput");
					alert(message);
					return false;
				}

				// if(!build_server_url_check_str){
				// 	alert('IP, PORT 형식에 맞지 않습니다.');
				// 	return false;
				// }
                //
				// if(common.isEmptyStr(build_server_url)){
				// 	alert("빌드 서버 URL을 입력하세요.");
				// 	return false;
				// }

				return true;
			};

			scwin.checkDataProjectName = function(){

				if(common.isEmptyStr(project_name)){
					var message = common.getLabel("lbl_check_project_name");
					alert(message);
					return false;
				}

				if(!project_name_check_str){
					var message = common.getLabel("lbl_setting_ftp_detail_nameError");
					alert(message);
					return false;
				}

				return true;
			};

			scwin.ftpDetailView = function(){

				var ftp_id = localStorage.getItem("_ftp_id_");

				var options = {};

				options.action = "/manager/ftp/setting/search/" + parseInt(ftp_id);
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.method = "GET";

				options.success = function (e) {
					var data = e.responseJSON;
					if (data != null) {

						var temp = {};

						ftp_setting_name.setValue(data.ftp_name);
						ftp_setting_url.setValue(data.ftp_url);
						ftp_setting_ip.setValue(data.ftp_ip);
						ftp_setting_port.setValue(data.ftp_port);
						ftp_setting_user_id.setValue(data.ftp_user_id);
						ftp_setting_user_pwd.setValue(data.ftp_user_pwd);

						temp["ftp_name"]	= data.ftp_name;
						temp["ftp_url"] = data.ftp_url;
						temp["created_date"]= data.created_date;
						temp["updated_date"]= data.updated_date;


					} else {

					}
				};

				options.error = function (e) {
					alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n");

				};

				$p.ajax( options );


			};

			scwin.saveftpSettingData = function(){
				var ftp_name = ftp_setting_name.getValue();
				var ftp_url = ftp_setting_url.getValue();
				var ftp_ip = ftp_setting_ip.getValue();
				var ftp_port = ftp_setting_port.getValue();
				var ftp_user_id = ftp_setting_user_id.getValue();
				var ftp_user_pwd = ftp_setting_user_pwd.getValue();

				var ftp_setting_mode = localStorage.getItem("_ftp_setting_mode_");

				var data = {};

                if(ftp_setting_mode == "detailview"){
					data.ftp_id = localStorage.getItem("_ftp_id_");
				}

				data.ftp_name = ftp_name;
				data.ftp_url = ftp_url;
				data.ftp_ip = ftp_ip;
				data.ftp_port = ftp_port;
				data.ftp_user_id = ftp_user_id;
				data.ftp_user_pwd = ftp_user_pwd;

				__ftp_setting_detail_data__.setJSON([data]);

				var ftp_setting_data = __ftp_setting_detail_data__.getRowJSON(0);
				var ftp_setting_mode = localStorage.getItem("_ftp_setting_mode_");

                if(ftp_setting_mode == "detailview"){
					scwin.setftpSettingAndUpdate(ftp_setting_data);
				}else {
					scwin.setftpSettingAndInsert(ftp_setting_data);
				}

			};

			scwin.select_check_FTP_name = function(ftp_name){

			    var data = {};
			    data.ftp_name = ftp_setting_name.getValue();

				if(common.isEmptyStr(data.ftp_name)){
					var message = common.getLabel("lbl_setting_ftp_detail_ftpName");
					alert(message);
					return false;
				}

				var options = {};

				options.action = "/manager/ftp/setting/search/checkName";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.method = "POST";
				options.requestData = JSON.stringify(data);

				options.success = function (e) {
					var data = e.responseJSON;
					if(e.responseStatusCode === 200 || e.responseStatusCode === 201){
						if (data != null) {
							var message = common.getLabel("lbl_exist_name");
							alert(message);
							scwin.check_FTP_name_yn = false;
						}
					}

				};

				options.error = function (e) {
					if(e.responseStatusCode === 500){
						var message = common.getLabel("lbl_can_use_name");
						alert(message);
						scwin.check_FTP_name_yn = true;
						// scwin.build_project_name_yn = true;
					}else {
						alert( "message:"+e.responseText+"\n" );
					}

				};

				$p.ajax( options );

			};

			scwin.setftpSettingAndInsert = function (ftp_setting_data) {

				var ftp_setting_json = {};

				ftp_setting_json = ftp_setting_data;

				var options = {};
				options.action = "/manager/ftp/setting/create";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.requestData = JSON.stringify(ftp_setting_json);
				options.method = "POST";

				options.success = function (e) {
					var data = e.responseJSON;
					if ((e.responseStatusCode === 200 || e.responseStatusCode === 201)&& data != null) {
						var message = common.getLabel("lbl_setting_ftp_detail_createInfo");
						alert(message);

						$p.parent().wfm_main.setSrc("/xml/settings.xml");

					} else {
						var message = common.getLabel("lbl_setting_ftp_detail_fail");
						alert(message);
					}
				};

				options.error = function (e) {
					alert( "message:"+e.responseText+"\n" );
				};

				$p.ajax( options );

			};

			scwin.setftpSettingAndUpdate = function (ftp_setting_data) {

				var ftp_setting_json = {};

				ftp_setting_json = ftp_setting_data;

				var options = {};
				options.action = "/manager/ftp/setting/update";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.requestData = JSON.stringify(ftp_setting_json);
				options.method = "POST";

				options.success = function (e) {
					var data = e.responseJSON;
					if ((e.responseStatusCode === 200 || e.responseStatusCode === 201)&& data != null) {
						var message = common.getLabel("lbl_setting_ftp_detail_modifyInfo");
						alert(message);

						$p.parent().wfm_main.setSrc("/xml/settings.xml");

					} else {
						var message = common.getLabel("lbl_setting_ftp_detail_modifyFail");
						alert(message);
					}
				};

				options.error = function (e) {
					alert( "message:"+e.responseText+"\n" );
				};

				$p.ajax( options );

			};

			scwin.btn_create_ftp_setting_onclick = function(e){
			    if(scwin.checkData()){
					scwin.saveftpSettingData();
				}

			};

			]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group class="gallery_box" id="" style="">
			<xf:group class="dfbox" id="" style="">
				<xf:group class="fl">
					<w2:textbox class="gal_tit fl" id="ftp_setting_title" label="" style="" useLocale="true" localeRef="lbl_setting_ftp_detail_setting"></w2:textbox>
				</xf:group>
				<xf:group class="fr" id="" style="">
					<xf:trigger class="btn_cm type1 fl" id="ftp_create_or_save_btn" style="" type="button" ev:onclick="scwin.btn_create_ftp_setting_onclick"
								useLocale="true" localeRef="lbl_create">
						<xf:label><![CDATA[]]></xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
			<xf:group class="gal_body" id="" style="">
				<xf:group id="" style="" class="form_wrap">
					<xf:group id="" style="" class="" tagname="ul">
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_name"></w2:textbox>
							<xf:group class="ipt_box" id="" style="">
								<xf:input id="ftp_setting_name" style="" adjustMaxLength="false"></xf:input>
								<xf:trigger id="" style="" class="btn_cm" type="button" ev:onclick="scwin.select_check_FTP_name"
											useLocale="true" localeRef="lbl_dup_check">
									<xf:label><![CDATA[]]></xf:label>
								</xf:trigger>
							</xf:group>
						</xf:group>
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_url"></w2:textbox>
							<xf:group id="" style="" class="ipt_box">
								<xf:input id="ftp_setting_url" style="" adjustMaxLength="false"></xf:input>
							</xf:group>
						</xf:group>
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_ip"></w2:textbox>
							<xf:group id="" style="" class="ipt_box">
								<xf:input id="ftp_setting_ip" style="" adjustMaxLength="false"></xf:input>
							</xf:group>
						</xf:group>
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_port"></w2:textbox>
							<xf:group id="" style="" class="ipt_box">
								<xf:input id="ftp_setting_port" style="" adjustMaxLength="false"></xf:input>
							</xf:group>
						</xf:group>
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_id"></w2:textbox>
							<xf:input id="ftp_setting_user_id" style="" adjustMaxLength="false"></xf:input>
						</xf:group>
						<xf:group id="" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_ftp_detail_password"></w2:textbox>
							<xf:input id="ftp_setting_user_pwd" dataType="password" type="password"  style="" adjustMaxLength="false"></xf:input>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>
