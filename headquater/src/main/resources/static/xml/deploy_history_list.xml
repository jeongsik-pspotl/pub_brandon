<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ev="http://www.w3.org/2001/xml-events"
	  xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head meta_horizontal_guides="7" meta_vertical_guides="NaN">
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate/>
		<xf:model>
			<xf:instance>
				<data xmlns=""/>
			</xf:instance>
			<w2:dataCollection baseNode="map">
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
		</xf:model>
		<script type="text/javascript" lazy="false"><![CDATA[

			scwin.onpageload = function() {
				common.setScopeObj(scwin);
				scwin.initPage();
			};

			scwin.onpageunload = function() {

			};

			scwin.initPage = function(){

				var workspace_json = $p.parent().__workspace_data__.getAllJSON();
				var buildproj_json = $p.parent().__buildproject_data__.getAllJSON();

				scwin.setWorkspace(workspace_json,buildproj_json);
			};

			/* workspace setting param workspace_json, buildproj_json */
			scwin.setWorkspace = function(workspace_json,buildproj_json){

				// var whive_session = sessionStorage.getItem("__whybrid_session__");
				// whive_session = JSON.parse(whive_session);

				for(var idx in workspace_json){
					var buildbtnInx = generator_history_workspace_list.insertChild();
					var workspace_select = generator_history_workspace_list.getChild(idx,"select_history_workpsace_title");
					workspace_select.setValue(workspace_json[idx].workspace_name);
					//workspace_select.addItem('false',workspace_json[idx].workspace_name,0);

					var temp_generator = generator_history_workspace_list.getChild(idx,"list_history_buildproj_generator");

					var count = 0;
					var android_cnt = 0;
					var windows_cnt = 0;
					var ios_cnt = 0;

					for(var idx2 in buildproj_json){
						if(buildproj_json[idx2].workspace_id == workspace_json[idx].id){

							// if (whive_session.user_role == "SUPERADMIN") {
                            //
							// 	temp_generator.insertChild();
                            //
							// 	//set icon
							// 	var span_icon = temp_generator.getChild(count,"buildproj_platform");
							// 	var txt_proj_name = temp_generator.getChild(count,"txt_buildproj_project_name");
                            //
                            //
							// 	var btn_history = temp_generator.getChild(count, "btn_history");
                            //
							// 	var grp_historyproj_btn = temp_generator.getChild(count, "grp_list_historyproj");
							// 	grp_historyproj_btn.setUserData("platform",buildproj_json[idx2].platform);
							// 	grp_historyproj_btn.setUserData("projectName",buildproj_json[idx2].project_name);
							// 	grp_historyproj_btn.setUserData("project_pkid",buildproj_json[idx2].project_id);
                            //
							// 	btn_history.setUserData("platform",buildproj_json[idx2].platform);
							// 	btn_history.setUserData("projectName",buildproj_json[idx2].project_name);
							// 	btn_history.setUserData("project_pkid",buildproj_json[idx2].project_id);
                            //
							// 	count++;
                            //
							// 	if(buildproj_json[idx2].platform == "Android"){
							// 		span_icon.addClass("ico_and");
							// 		span_icon.setValue("Android");
							// 		android_cnt++;
							// 	} else if(buildproj_json[idx2].platform == "Windows"){
							// 		// span_icon.addClass("ico_win");
							// 		// span_icon.setValue("Android");
							// 		// windows_cnt++;
							// 	}else {
							// 		span_icon.addClass("ico_ios");
							// 		span_icon.setValue("iOS");
							// 		ios_cnt++;
							// 	}
							// 	txt_proj_name.setValue(buildproj_json[idx2].project_name);
                            //
							// } else
                            if(buildproj_json[idx2].deploy_yn == "1"){
							    // btn_build.show();
								// btn_history.show();

								temp_generator.insertChild();

								//set icon
								var span_icon = temp_generator.getChild(count,"buildproj_platform");
								var txt_proj_name = temp_generator.getChild(count,"txt_buildproj_project_name");
								var btn_history = temp_generator.getChild(count, "btn_history");

								var grp_historyproj_btn = temp_generator.getChild(count, "grp_list_historyproj");
								grp_historyproj_btn.setUserData("platform",buildproj_json[idx2].platform);
								grp_historyproj_btn.setUserData("projectName",buildproj_json[idx2].project_name);
								grp_historyproj_btn.setUserData("project_pkid",buildproj_json[idx2].project_id);

								btn_history.setUserData("platform",buildproj_json[idx2].platform);
								btn_history.setUserData("projectName",buildproj_json[idx2].project_name);
								btn_history.setUserData("project_pkid",buildproj_json[idx2].project_id);

								count++;

								if(buildproj_json[idx2].platform == "Android"){
                                    var message = common.getLabel("lbl_android")
									span_icon.addClass("ico_and");
									span_icon.setValue(message);
									android_cnt++;
								} else if(buildproj_json[idx2].platform == "Windows"){
									// span_icon.addClass("ico_win");
									// span_icon.setValue("Android");
									// windows_cnt++;
								}else {
                                    var message = common.getLabel("lbl_ios");
									span_icon.addClass("ico_ios");
									span_icon.setValue(message);
									ios_cnt++;
								}
								txt_proj_name.setValue(buildproj_json[idx2].project_name);

							} else {

							}
						}
					}

                    var label_android = common.getLabel("lbl_android_count");
                    label_android = common.getFormatStr(label_android, android_cnt);
                    var label_ios = common.getLabel("lbl_ios_count");
                    label_ios = common.getFormatStr(label_ios, ios_cnt);

					var span_android = generator_history_workspace_list.getChild(idx,"count_android");
					span_android.setValue(label_android);
					// var span_windows = generator_history_workspace_list.getChild(idx,"count_windows");
					// span_windows.setValue("Windows<span>"+windows_cnt+"</span>");
					var span_ios = generator_history_workspace_list.getChild(idx,"count_ios");
					span_ios.setValue(label_ios);
				}
			};

			scwin.grp_list_link_onclick = function(e){
				var controlList = this.parentControl.parentControl.childControlList;
				for(var idx in controlList){
					if(controlList[idx] === this.parentControl){
						this.parentControl.toggleClass("on");
					} else {
						controlList[idx].removeClass("on");
					}
				}
			};

			scwin.grp_list_historyproj_onclick = function(e){
				var platform = this.getUserData("platform");
				var project_pkid = this.getUserData("project_pkid");
				var project_name = this.getUserData("projectName");

				localStorage.setItem("historyPlatform",platform);
				localStorage.setItem("historyProjectName",project_name);
				localStorage.setItem("historyProjectId",project_pkid);

				$p.parent().wfm_main.setSrc("/xml/deploy_history_detail.xml");
				WebSquare.getBody().hideToolTip();

			};

			scwin.btn_history_onclick = function(e){
				var platform = this.getUserData("platform");
				var buildProjectName = this.getUserData("projectName");
				var build_project_id = this.getUserData("project_pkid");

				localStorage.setItem("historyPlatform",platform);
				localStorage.setItem("historyProjectName",buildProjectName);
				localStorage.setItem("historyProjectId",build_project_id);

				$p.parent().wfm_main.setSrc("/xml/deploy_history_detail.xml");
				WebSquare.getBody().hideToolTip();
			};

			]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group class="sub_contents" id="" style="">
			<xf:group id="" style="" class="white_board">
				<xf:group style="" id="" class="work">
					<xf:group style="" id="" class="pgtbox">
						<w2:textbox style="" id="" label="" class="pgt_tit fl"  useLocale="true" localeRef="lbl_deploy_history_list_title"></w2:textbox>
						<xf:group style="" id="" class="fr">
							<!--    						<xf:trigger class="btn_cm" id="" style="" type="button">-->
							<!--    							<xf:label><![CDATA[생성]]></xf:label>-->
							<!--    						</xf:trigger>-->
<!--							<xf:trigger class="btn_cm" id="" style="" type="button">-->
<!--								<xf:label><![CDATA[삭제]]></xf:label>-->
<!--							</xf:trigger>-->
							<!--    						<xf:trigger class="btn_cm type1" id="" style="" type="button">-->
							<!--    							<xf:label><![CDATA[저장]]></xf:label>-->
							<!--    						</xf:trigger>-->
						</xf:group>
					</xf:group>
					<xf:group class="fav_list">
						<w2:generator tagname="ul" style="" id="generator_history_workspace_list" class="">
							<xf:group tagname="li" style="" id="" class="">
								<xf:group tagname="" style="" id="grp_list_link" class="fav_link" ev:onclick="scwin.grp_list_link_onclick">
									<xf:group style="" id="" class="left">
<!--										<xf:select ref="" appearance="full" style="" id="select_history_workpsace_title" selectedindex="-1" rows="" renderType="component"-->
<!--												   cols="">-->
<!--											<xf:choices>-->
<!--											</xf:choices>-->
<!--										</xf:select>-->
										<w2:textbox tagname="span" style="" id="select_history_workpsace_title" label=""
													class="txt_date">
										</w2:textbox>
									</xf:group>
									<xf:group style="" id="" class="right">
										<w2:anchor outerDiv="false" style="" id="count_android" class="btn_android" useLocale="true" localeRef="lbl_android_count">
											<xf:label><![CDATA[]]></xf:label>
										</w2:anchor>
<!--										<w2:anchor outerDiv="false" style="" id="count_windows" class="btn_window">-->
<!--											<xf:label><![CDATA[Windows<span>0</span>]]></xf:label>-->
<!--										</w2:anchor>-->
										<w2:anchor outerDiv="false" style="" id="count_ios" class="btn_ios" useLocale="true" localeRef="lbl_ios_count">
											<xf:label><![CDATA[]]></xf:label>
										</w2:anchor>
									</xf:group>
								</xf:group>
<!--								<xf:group style="" id="" class="fav_cont">-->
									<w2:generator style="" id="list_history_buildproj_generator" class="fav_cont">
<!--										<xf:group style="" id="" class="grp_items">-->
											<xf:group style="" id="" class="item">
											<xf:group style="" id="" class="item_gp">
												<xf:group style="" id="grp_list_historyproj" class="dev_tit" ev:onclick="scwin.grp_list_historyproj_onclick">
													<w2:span style="" id="buildproj_platform" label="" class=""></w2:span>
													<w2:textbox style="cursor:pointer;" id="txt_buildproj_project_name" label="" class="txt_name"></w2:textbox>
												</xf:group>
												<xf:group style="" id="" class="dev_link">
													<xf:group style="" id="" class="grp_link">
														<w2:anchor outerDiv="false" style="" id="btn_history" class="btn_i_reset" ev:onclick="scwin.btn_history_onclick"
																   toolTip="tooltip" toolTipDisplay="true" useLocale="true" localeRef="lbl_history" tooltipLocaleRef="lbl_deploy_history_list_tooltip_history">
															<xf:label><![CDATA[]]></xf:label>
														</w2:anchor>
														<!--														<w2:anchor outerDiv="false" style="" id="btn_delete" class="btn_i_option" ev:onclick="scwin.btn_delete_onclick">-->
														<!--															<xf:label><![CDATA[delete]]></xf:label>-->
														<!--														</w2:anchor>-->
													</xf:group>
												</xf:group>
											</xf:group>
											</xf:group>
<!--										</xf:group>-->
									</w2:generator>
<!--								</xf:group>-->
							</xf:group>
						</w2:generator>
					</xf:group>

				</xf:group>
			</xf:group></xf:group>
	</body>
</html>
