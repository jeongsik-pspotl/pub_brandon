<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ev="http://www.w3.org/2001/xml-events"
	  xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate/>
		<xf:model>
			<xf:instance>
				<data xmlns=""/>
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="__vcs_setting_detail_data__" saveRemovedData="true">
					<w2:columnInfo>
						<w2:column id="vcs_id" name="vcs_id" dataType="text"></w2:column>
						<w2:column id="role_code_id" name="role_code_id" dataType="text"></w2:column>
						<w2:column id="vcs_type" name="vcs_type" dataType="text"></w2:column>
						<w2:column id="vcs_name" name="vcs_name" dataType="text"></w2:column>
						<w2:column id="vcs_url" name="vcs_url" dataType="text"></w2:column>
						<w2:column id="vcs_user_id" name="vcs_user_id" dataType="text"></w2:column>
						<w2:column id="vcs_user_pwd" name="vcs_user_pwd" dataType="text"></w2:column>
						<w2:column id="create_date" name="create_date" dataType="text"></w2:column>
						<w2:column id="update_date" name="update_date" dataType="text"></w2:column>
						<w2:column id="admin_id" name="admin_id" dataType="text"></w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
		</xf:model>
		<script type="text/javascript" lazy="false">
			 <![CDATA[
			scwin.check_vcs_nameYN = false;
			scwin.onpageload = function() {
				// 화면 구성 변경
				var vcs_setting_mode = localStorage.getItem("_vcs_setting_mode_");

				if (vcs_setting_mode == "detailview"){
					var view = common.getLabel("lbl_setting_vcs_detail_detailView");
					var save = common.getLabel("lbl_save");
					vcs_setting_title.setLabel(view);
					vcs_create_or_save_btn.setLabel(save);
					vcs_setting_name.setDisabled(true);
					vcs_setting_url.setDisabled(false);
					scwin.vcsDetailView();

					// if(whive_session.user_role == "SUPERADMIN"){
                    //
                    //
					// }else {
						domain_id_grp.hide();
						admin_id_grp.hide();
						//setting_admin_list.setDisabled(true);
						// setting_domain_list.setDisabled(true);
					// }

				}else {
					var create = common.getLabel("lbl_setting_vcs_detail_tool");
					var regist = common.getLabel("lbl_regist");
					vcs_setting_title.setLabel(create);
					vcs_create_or_save_btn.setLabel(regist);
					vcs_setting_name.setDisabled(false);
					vcs_setting_url.setDisabled(false);



					// if(whive_session.user_role == "SUPERADMIN"){
						// scwin.select_domain_list();
						// setting_admin_list.addItem("", "선택안함");

					// }else {
						domain_id_grp.hide();
						admin_id_grp.hide();

						//setting_admin_list.setDisabled(true);
						// setting_domain_list.setDisabled(true);
					//}

				}

			};

			scwin.onpageunload = function() {

			};

			scwin.checkDataVCSName = function(){

				var vcs_name = vcs_setting_name.getValue();

				if(common.isEmptyStr(vcs_name)){
					var message = common.getLabel("lbl_setting_vcs_detail_vcsName");
					alert(message);
					return false;
				}

				return true;
			};

			scwin.checkAllVCS = function(){

				var vcs_name = vcs_setting_name.getValue();
				var vcs_type = vcs_setting_vcs_type_code.getValue();

				if(common.isEmptyStr(vcs_name)){
					var message = common.getLabel("lbl_setting_vcs_detail_vcsName");
					alert(message);
					return false;
				}

				if(!scwin.check_vcs_nameYN){
					var message = common.getLabel("lbl_setting_vcs_detail_vcsDuplicate");
					alert(message);
					return false;
				}

				if(vcs_type == "git" && vcs_setting_user_id.getValue() == ""){
					var message = common.getLabel("lbl_setting_vcs_detail_gitId");
					alert(message);
					return false;
				}

				if(vcs_type == "git" && vcs_setting_user_pwd.getValue() == ""){
					var message = common.getLabel("lbl_setting_vcs_detail_gitPwd");
					alert(message);
					return false;
				}

				if(vcs_type == "git" && vcs_setting_url.getValue() == ""){
					var message = common.getLabel("lbl_setting_vcs_detail_gitUrl");
					alert(message);
					return false;
				}

				// if(vcs_type != "localgit" && vcs_setting_url.getValue() == ""){
				// 	alert("내부 저장소 type은 Url을 압력하세요.");
				// 	return false;
				// }

				return true;

			};

			scwin.vcsDetailView = function(){

				var vcs_id = localStorage.getItem("_vcs_id_");

				var options = {};

				options.action = "/manager/vcs/search/profile/" + parseInt(vcs_id);
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.method = "GET";

				options.success = function (e) {
					var data = e.responseJSON;
					if (data != null) {

						var settingvcs = [];
						var temp = {};


						vcs_setting_vcs_type_code.setValue(data.vcs_type);
						vcs_setting_user_id.setValue(data.vcs_user_id);
						vcs_setting_user_pwd.setValue(data.vcs_user_pwd);
						vcs_setting_name.setValue(data.vcs_name);

                        if(data.vcs_type == "localgit"){

						}else {
							vcs_setting_url.setValue(data.vcs_url);
						}



						var temp = {};

						temp.vcs_id = data.vcs_id;
						temp.vcs_type = data.vcs_type;
						temp.vcs_user_id = data.vcs_user_id;
						temp.vcs_user_pwd = data.vcs_user_pwd;
						temp.vcs_name = data.vcs_name;
						temp.vcs_url = data.vcs_url;
						temp.created_date = data.created_date;
						temp.updated_date = data.updated_date;

						__vcs_setting_detail_data__.setJSON([data]);
					} else {

					}
				};

				options.error = function (e) {
					alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n");

				};

				$p.ajax( options );


			};

			scwin.saveVCSSettingData = function(){

				var vcs_setting_mode = localStorage.getItem("_vcs_setting_mode_");

				var vcs_setting_data = __vcs_setting_detail_data__.getRowJSON(0);

				var vcs_type = vcs_setting_vcs_type_code.getValue();
				var vcs_user_id = vcs_setting_user_id.getValue();
				var vcs_user_pwd = vcs_setting_user_pwd.getValue();
				var vcs_name = vcs_setting_name.getValue();
				var vcs_url = vcs_setting_url.getValue();

				var data = {};
				data.vcs_id = vcs_setting_data.vcs_id;
				data.vcs_type = vcs_type;
				data.vcs_user_id = vcs_user_id;
				data.vcs_user_pwd = vcs_user_pwd;
				data.vcs_name = vcs_name;
				data.vcs_url = vcs_url;

				// if(whive_session.user_role == "SUPERADMIN"){

					// data.admin_id = setting_admin_list.getValue();


				// } else if (whive_session.user_role == "ADMIN"){

				/* admin id 컨트롤러 단에서 처리해야함.
					data.admin_id = whive_session.id; // 수정해야함...

				 */


				// }


				__vcs_setting_detail_data__.removeAll();
				__vcs_setting_detail_data__.setJSON([data]);

				vcs_setting_data = __vcs_setting_detail_data__.getRowJSON(0);

				if (vcs_setting_mode == "detailview"){
					scwin.setVCSSettingAndUpdate(vcs_setting_data);
				}else {
				    if(scwin.checkAllVCS()){
						scwin.setVCSSettingAndInsert(vcs_setting_data);
					}

				}


			};

			scwin.select_check_vcs_name = function(vcs_name){
				var data = {};
				data.vcs_name = vcs_name;
				var options = {};

				options.action = "/manager/vcs/search/checkProfileName";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.requestData = JSON.stringify(data);
				options.method = "POST";

				options.success = function (e) {
					var data = e.responseJSON;
					if(e.responseStatusCode === 200 || e.responseStatusCode === 201){
						if (data != null) {
							if(data[0].vcs_name_not_found == "no"){
								var message = common.getLabel("lbl_can_use_name");
								alert(message);
								scwin.check_vcs_nameYN = true;

							}else if(data[0].vcs_name_not_found == "yes"){
								var message = common.getLabel("lbl_exist_name");
								alert(message);
								scwin.check_vcs_nameYN = false;
							}

						}
					}

				};

				options.error = function (e) {
					if(e.responseStatusCode === 500){


					}else {

					}

				};

				$p.ajax( options );

			};

			scwin.setVCSSettingAndInsert = function (vcs_setting_data) {

				var vcs_setting_json = {};

				vcs_setting_json = vcs_setting_data;

				var options = {};
				options.action = "/manager/vcs/create";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.requestData = JSON.stringify(vcs_setting_json);
				options.method = "POST";

				options.success = function (e) {
					var data = e.responseJSON;
					if ((e.responseStatusCode === 200 || e.responseStatusCode === 201)&& data != null) {
						var message = common.getLabel("lbl_setting_vcs_detail_info");
						alert(message);
						$p.parent().wfm_main.setUserData("settingsData","vcs");
						$p.parent().wfm_main.setSrc("/xml/settings.xml");

					} else {
						var message = common.getLabel("lbl_setting_vcs_detail_fail");
						alert(message);
					}
				};

				options.error = function (e) {
					alert( "message:"+e.responseText+"\n" );

				};

				$p.ajax( options );

			};

			scwin.setVCSSettingAndUpdate = function (vcs_setting_data) {

				var vcs_setting_json = {};

				vcs_setting_json = vcs_setting_data;

				var options = {};
				options.action = "/manager/vcs/update";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.requestData = JSON.stringify(vcs_setting_json);
				options.method = "POST";

				options.success = function (e) {
					var data = e.responseJSON;
					if ((e.responseStatusCode === 200 || e.responseStatusCode === 201)&& data != null) {
						var message = common.getLabel("lbl_setting_vcs_detail_infoSetting");
						alert(message);
						$p.parent().wfm_main.setUserData("settingsData","vcs");
						$p.parent().wfm_main.setSrc("/xml/settings.xml");

					} else {
						var message = common.getLabel("lbl_setting_vcs_detail_infoFail");
						alert(message);
					}
				};

				options.error = function (e) {
					alert( "message:"+e.responseText+"\n" );

				};

				$p.ajax( options );

			};

			scwin.btn_prev_onclick = function(e){

			};

			scwin.btn_next_onclick = function(e){
				if(scwin.checkData()){

				}
			};

			scwin.btn_create_vcs_setting_onclick = function(e){
				scwin.saveVCSSettingData();


			};

			scwin.step1_select_role_code_onchange = function(e){
				var platform = this.getValue(this.getSelectedIndex);
				localStorage.setItem("_role_code_id_",platform);
			};

			scwin.step1_btn_check_project_name_onclick = function(e){
				var vcs_name = vcs_setting_name.getValue();

				if(scwin.checkDataVCSName()){
					scwin.select_check_vcs_name(vcs_name);
				}

			};

			scwin.setting_select_domain_onchange = function(e){

				var domainID = setting_domain_list.getValue();

				if(domainID == ""){
					setting_admin_list.removeAll(false);
                    var message = common.getLabel("lbl_select");
					setting_admin_list.addItem("",message); //선택

				}else {
					scwin.select_admin_list(domainID);
				}

			};

			scwin.select_admin_list = function(domainID){

				var options = {};

				options.action = "/manager/member/search/userInfoForSelectBox/" + parseInt(domainID);
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.method = "GET";

				options.success = function (e) {
					var data = e.responseJSON;
					if (data != null) {
						setting_admin_list.removeAll(false);

                        var message = common.getLabel("lbl_select");
						setting_admin_list.addItem("",message); //선택
						for (var row in data) {
							var temp = {};

							setting_admin_list.addItem(data[row].user_id, data[row].user_name);

						}

					} else {

					}
				};

				options.error = function (e) {
					alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n");

				};

				$p.ajax( options );

			};

			// domain 리스트 전체 조회
			scwin.select_domain_list = function(){

				var options = {};

				options.action = "/manager/domain/search/domainList";
				options.mode = "asynchronous";
				options.mediatype = "application/json";
				options.method = "GET";

				options.success = function (e) {
					var data = e.responseJSON;
					if (data != null) {
                        var message = common.getLabel("lbl_select");
						setting_domain_list.addItem("",message); //선택
						for (var row in data) {
							var temp = {};

							setting_domain_list.addItem(data[row].domain_id, data[row].domain_name);

						}

					} else {

					}
				};

				options.error = function (e) {
					alert("code:"+e.status+"\n"+"message:"+e.responseText+"\n");

				};

				$p.ajax( options );

			};

			]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
		<xf:group class="gallery_box" id="" style="">
			<xf:group class="dfbox" id="" style="">
				<xf:group class="fl">
					<w2:textbox class="gal_tit fl" id="vcs_setting_title" label="" style="" useLocale="true" localeRef="lbl_setting_vcs_detail_tool"></w2:textbox>
				</xf:group>
				<xf:group class="fr" id="" style="">
					<xf:trigger class="btn_cm type1 fl" id="vcs_create_or_save_btn" style="" type="button" ev:onclick="scwin.btn_create_vcs_setting_onclick"
								useLocale="true" localeRef="lbl_regist">
						<xf:label><![CDATA[]]></xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
			<xf:group class="gal_body" id="" style="">
				<xf:group id="" style="" class="form_wrap">
					<xf:group id="" style="" class="" tagname="ul">
						<xf:group id="" style="" class="tooltip_box" tagname="li">
							<xf:group class="ipt_box" id="" style="">
								<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_version_manage_tool_profile"></w2:textbox>
								<w2:anchor class="ico_tip" id="" outerDiv="false" style="" toolTip="tooltip" tooltipLocaleRef="lbl_setting_vcs_detail_infoSeparator" toolTipDisplay="true"
										   useLocale="true">
									<xf:label><![CDATA[]]></xf:label>
								</w2:anchor>
							</xf:group>
							<xf:group class="ipt_box" id="" style="">
								<xf:input id="vcs_setting_name" style="" adjustMaxLength="false"></xf:input>
								<xf:trigger id="" style="" class="btn_cm" type="button" ev:onclick="scwin.step1_btn_check_project_name_onclick"
											useLocale="true" localeRef="lbl_dup_check">
									<xf:label><![CDATA[]]></xf:label>
								</xf:trigger>
							</xf:group>
						</xf:group>
						<xf:group id="domain_id_grp" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_domain_id"></w2:textbox>
							<xf:select1 renderType="native" id="setting_domain_list" disabledClass="w2selectbox_disabled" ref="" appearance="minimal" style="" direction="auto" chooseOption="" allOption="" displayMode="label" disabled="false" submenuSize="auto" ev:onchange="scwin.setting_select_domain_onchange">
								<xf:choices>

								</xf:choices>
							</xf:select1>
						</xf:group>
						<xf:group id="admin_id_grp" style="" class="" tagname="li">
							<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_admin_id"></w2:textbox>
							<xf:select1 renderType="native" id="setting_admin_list" disabledClass="w2selectbox_disabled" ref="" appearance="minimal" style="" direction="auto" chooseOption="" allOption="" displayMode="label" disabled="false" submenuSize="auto" ev:onchange="scwin.setting_select_admin_onchange">
								<xf:choices>

								</xf:choices>
							</xf:select1>
						</xf:group>
						<xf:group id="" style="" class="tooltip_box" tagname="li">
							<xf:group class="ipt_box" id="" style="">
								<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_vcs_detail_toolType"></w2:textbox>
								<w2:anchor class="ico_tip" id="" outerDiv="false" style="" toolTip="tooltip" toolTipDisplay="true"
										   useLocale="true" tooltipLocaleRef="lbl_setting_vcs_detail_tools">
									<xf:label><![CDATA[]]></xf:label>
								</w2:anchor>
							</xf:group>
							<xf:select1 renderType="native" id="vcs_setting_vcs_type_code" disabledClass="w2selectbox_disabled" ref="" appearance="minimal" style="" direction="auto" chooseOption="" allOption="" displayMode="label" disabled="false" submenuSize="auto" ev:onchange="scwin.step1_select_role_code_onchange">
								<xf:choices>
									<xf:item>
										<xf:label><![CDATA[내부 저장소 git]]></xf:label>
										<xf:value><![CDATA[localgit]]></xf:value>
									</xf:item>
									<!--<xf:item>
										<xf:label><![CDATA[내부 저장소 svn]]></xf:label>
										<xf:value><![CDATA[localsvn]]></xf:value>
									</xf:item>-->
									<xf:item>
										<xf:label><![CDATA[Github]]></xf:label>
										<xf:value><![CDATA[git]]></xf:value>
									</xf:item>
									<!--<xf:item>
										<xf:label><![CDATA[외부 저장소 svn]]></xf:label>
										<xf:value><![CDATA[svn]]></xf:value>
									</xf:item>-->
								</xf:choices>
							</xf:select1>
						</xf:group>
						<xf:group id="" style="" class="tooltip_box" tagname="li">
							<xf:group class="ipt_box" id="" style="">
								<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_vcs_detail_id"></w2:textbox>
								<w2:anchor class="ico_tip" id="" outerDiv="false" style="" toolTip="tooltip" toolTipDisplay="true"
										   useLocale="true" tooltipLocaleRef="lbl_setting_vcs_detail_necessaryId" >
									<xf:label><![CDATA[]]></xf:label>
								</w2:anchor>
							</xf:group>
							<xf:input id="vcs_setting_user_id" style="" adjustMaxLength="false"></xf:input>
						</xf:group>
						<xf:group id="" style="" class="tooltip_box" tagname="li">
							<xf:group class="ipt_box" id="" style="">
								<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_vcs_detail_password"></w2:textbox>
								<w2:anchor class="ico_tip" id="" outerDiv="false" style="" toolTip="tooltip" toolTipDisplay="true"
										   useLocale="true" tooltipLocaleRef="lbl_setting_vcs_detail_necessaryPw" >
									<xf:label><![CDATA[]]></xf:label>
								</w2:anchor>
							</xf:group>
							<xf:input id="vcs_setting_user_pwd" style="" dataType="password" type="password"  adjustMaxLength="false"></xf:input>
						</xf:group>
						<xf:group id="" style="" class="tooltip_box" tagname="li">
							<xf:group class="ipt_box" id="" style="">
								<w2:textbox id="" style="" class="form_name" label="" useLocale="true" localeRef="lbl_setting_vcs_detail_address"></w2:textbox>
								<w2:anchor class="ico_tip" id="" outerDiv="false" style="" toolTip="tooltip" toolTipDisplay="true"
										   useLocale="true" tooltipLocaleRef="lbl_setting_vcs_detail_serverAddress">
									<xf:label><![CDATA[]]></xf:label>
								</w2:anchor>
							</xf:group>
							<xf:group id="" style="" class="ipt_box">
								<xf:input id="vcs_setting_url" style="" adjustMaxLength="false"></xf:input>
							</xf:group>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>
