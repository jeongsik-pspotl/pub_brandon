<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map"/>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
		<script type="text/javascript" src="/js/lib/qrcode.min.js"></script>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
	common.setScopeObj(scwin);

	var paramData = $p.getParameter("param");

    var qrcodeID = paramData.data.historyCnt;

    var userName = paramData.data.user_name;
	whive_event_text.setLabel("<b>"+userName + "님 W-Hive 참여 이벤트 당첨</b>을 축하드립니다! 🥳<br/><br/>");
	whive_event_longtext.setLabel("W-Hive에 관심을 갖고 앱을 생성해 주셔서 감사합니다.<br/>가입하실 때 기재하신 핸드폰 번호로 " +
			"<span style='background-color:#fff68e'>신세계 상품권 1만원권</span>을<br/> 9월 12일 이후 순차 증정할 예정입니다." +
			"<br/><br/>밑에 리뷰 작성 시, 추첨을 통해 <span style='background-color:#fff68e'>추가 상품</span>을 드리니 놓치지 마세요!");

	scwin.buildAfterQrcodeCreateByID(qrcodeID);

};

scwin.btn_submit_onclick = function(e) {

    // 최소 20글자 입력 조건 추가
	var comment = build_event_textarea.getValue();

    if(comment.length < 20){

        alert("최소 20글자 입력해야합니다.");
        return false;
	}

    if(comment.length > 400){

		alert("최대 400글자까지 입력 가능합니다.");
		return false;
	}

	// ajax submit
	var data = {};
    data.comment = comment;


	$.ajax({
			url : "/manager/build/history/whiveEvent",
			type : "post",
			accept : "application/json",
			contentType : "application/json; charset=utf-8",
			data : JSON.stringify(data),
			dataType : "json",
			success : function(r,status) {
				// alert(r);
				// alert(status);
				if(status === "success"){
					// alert("이벤트 등록이 완료 되었습니다.");

					popup_window_wframe.close();

					var opts = {
						"id":"popup2",
						"width": 380,
						"height": 223,
						"name":"알림"
					};

					common.win.alert("리뷰이벤트 등록이 완료되었습니다.",function(){
						// console.log("user close");

					},opts);



				}

			},
			error:function(request,status,error){
				var message = request.responseJSON;

				alert("message:"+message[0].result+"\n");
				popup_window_wframe.close();
			}

	});


};

function getTextLength(str) {
	var len = 0;

	for (var i = 0; i < str.length; i++) {
		if (escape(str.charAt(i)).length == 6) {
			len++;
		}
		len++;
	}
	return len;
}

scwin.btn_event_textarea_keyup = function(e){

    var comment = this.getValue();
	current.setLabel(comment.length); // 실시간 글자수 카운팅
	if(comment.length>20){
		current.setStyle("color","#000000");
	}

	if(comment.length > 400){
        alert("최대 400자까지 가능합니다.");
        this.getValue(comment.substring(0,400));
		current.setLabel("400"); // 실시간 글자수 카운팅
	}

};

scwin.reviewLengthValidate = function(value){
	if(value.length < 20){
		current.setStyle("color","#ff0000");
	} else {
		current.setStyle("color","#000000");
	}
	return value;
};

scwin.btn_cancel_onclick = function(){

	popup_window_wframe.close();

};

scwin.buildAfterQrcodeCreateByID = function(qrcodeID){
	// console.log(g_config.HTTPSERVER_URL);
	var qrcode = new QRCode(document.getElementById("build_event_qrcode"),{
		text: g_config.HTTPSERVER_URL + "/builder/build/history/CheckAuthPopup/"+parseInt(qrcodeID),
		width: 120,
		height: 120,
		colorDark : "#000000",
		colorLight : "#ffffff",
		correctLevel : QRCode.CorrectLevel.H
	});

};


]]></script>
<style>

	.w2window_header { display:none; }

	.w2window_body { top: 0px; }

	.w2window {
	position: absolute;
	background-color: #fff;
	border: 0px;
	}

	.w2window_restored {
	top:50% !important;
	left:50% !important;
	transform: translateX(-50%) translateY(-50%);
	}

	.flex_container {
	display: flex;
	align-items: center;
	justify-content: space-between;
	}

	.w2tb .w2tb_th {
	text-align: center;
	background: #FFFFFF;
	border: 0px;
	}

	.w2tb .w2tb_td {
	margin: 0;
	border: 0px;
	vertical-align: middle;
	}

	.w2popup_window .w2window_content {
	top:0px;
	bottom:0px;
	left:0px;
	right:0px;
	border-top:0px;
	border-left:0px;
	border-right:0px;
	border-bottom:0px;
	}

	.submit_btn {
	display: inline-block;
	height: 28px;
	padding: 0 12px;
	line-height: 26px;
	font-size: 12px;
	color: #ffffff;
	background: #8851da;
	vertical-align: top;
	border:0px;
	border-radius: 3px;
	}
	.cancel_btn {
		display: inline-block;
		height: 28px;
		padding: 0 12px;
		line-height: 26px;
		font-size: 12px;
		color: #ffffff;
		background: #a4a4a4;
		vertical-align: top;
		border:0px;
		border-radius: 3px;
	}
</style>
    </head>
    <body ev:onpageload="scwin.onpageload">
    <xf:group id="" style="padding:24px 26px 0px 24px;"><xf:group tagname="table" style="width:100%;" id="" class="w2tb">
    		<w2:attributes>
    			<w2:summary></w2:summary>
    		</w2:attributes>
    		<xf:group tagname="caption"></xf:group>
    		<xf:group tagname="colgroup">
    			<xf:group tagname="col" style="width:30.00%"></xf:group>
    			<xf:group tagname="col" style="width:70.00%"></xf:group>
    		</xf:group>
    		<xf:group tagname="tr">
    			<xf:group tagname="th" style="vertical-align:top;padding: 8px 24px 8px 8px;" class="w2tb_th">
    				<w2:attributes>
    					<w2:scope>row</w2:scope>
    				</w2:attributes>
<!--    				<xf:image src="sample_qr.png" style="width:120px;height:120px;" id=""></xf:image>-->
					<div id="build_event_qrcode" style="width: 120px;height:120px;margin: auto;"></div>
    			</xf:group>
    			<xf:group tagname="td" style="vertical-align:top;" class="w2tb_td">
    				<w2:textbox id="whive_event_text" label="XX님 W-Hive 참여 이벤트 당첨을 축하드립니다! 🥳&lt;br/&gt; &lt;br/&gt;" style="width: 100%; font-size: medium"></w2:textbox>
<!--					<w2:textbox style="width: 100%;" id=""-->
<!--								label="W-Hive에 관심을 갖고 앱을 생성해 주셔서 감사합니다.&lt;br/&gt;가입하실 때 기재하신 핸드폰 번호로 신세계 상품권 1만원권을&lt;br/&gt; 9월 12일 이후 순차 증정할 예정입니다.&lt;br/&gt;&lt;br/&gt;밑에 리뷰 작성 시, 추첨을 통해 추가 상품을 드리니 놓치지 마세요!">-->
<!--					</w2:textbox>-->
    				<w2:textbox style="width: 100%;" id="whive_event_longtext"
    					label="W-Hive에 관심을 갖고 앱을 생성해 주셔서 감사합니다.&lt;br/&gt;가입하실 때 기재하신 핸드폰 번호로 신세계 상품권 1만원권을&lt;br/&gt; 9월 12일 이후 순차 증정할 예정입니다.&lt;br/&gt;&lt;br/&gt;밑에 리뷰 작성 시, 추첨을 통해 추가 상품을 드리니 놓치지 마세요!">
    				</w2:textbox>
    			</xf:group>
    		</xf:group>
    		<xf:group tagname="tr">
    			<xf:group tagname="th" style="vertical-align:top;padding: 8px 24px 0px 8px;" class="w2tb_th">
    				<w2:attributes>
    					<w2:scope>row</w2:scope>
    				</w2:attributes>
    				<w2:textbox id="" label="QRCode" style="width: 100%;height: 35px; font-weight:bold;font-size: x-large;padding: 8px 0px 8px;"></w2:textbox>
					<w2:textbox id="" label="카메라앱으로 스캔하시면&lt;br/&gt;설치할 수 있습니다" style="font-size: smaller;"></w2:textbox>
    			</xf:group>
    			<xf:group tagname="td" style="" class="w2tb_td">

    				<xf:textarea minlength="20" maxlength="400" style="width: 100%;height: 100px;" id="build_event_textarea" placeholder="최소 20자 이상 입력해야합니다." validator="scwin.reviewLengthValidate" ev:onkeyup="scwin.btn_event_textarea_keyup"></xf:textarea>
					<xf:group style="float:right;" id="theCount">
						<w2:span label="0" style="color:#ff0000;" id="current"></w2:span>
						<w2:span label=" / 400" style="" id="maximum"></w2:span>
					</xf:group>
    			</xf:group>
    		</xf:group>
    		<xf:group tagname="tr">
    			<xf:group tagname="th" style="" class="w2tb_th">
    				<w2:attributes>
    					<w2:scope>row</w2:scope>
    				</w2:attributes>
    			</xf:group>
    			<xf:group tagname="td" style="" class="w2tb_td">
					<xf:group id="" style="" class="flex_container">
						<xf:trigger type="button" style="width: 80px;height: 23px; margin-top:35px;" id="btn_submit" class="submit_btn" ev:onclick="scwin.btn_submit_onclick">
							<xf:label><![CDATA[리뷰등록]]></xf:label>
						</xf:trigger>
						<xf:trigger type="button" style="width: 80px;height: 23px; margin-top:35px;" id="btn_cancel" class="cancel_btn" ev:onclick="scwin.btn_cancel_onclick">
							<xf:label><![CDATA[닫기]]></xf:label>
						</xf:trigger>
					</xf:group>
    			</xf:group>
    		</xf:group>
    	</xf:group></xf:group></body>
</html>
