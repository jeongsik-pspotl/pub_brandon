<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
    	<w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data xmlns=""/>
            </xf:instance>
            <w2:dataCollection baseNode="map">
            </w2:dataCollection>
            <w2:workflowCollection>
            </w2:workflowCollection>
        </xf:model>
         <script type="text/javascript" lazy="false"><![CDATA[
        
	scwin.onpageload = function() {
		// WebSquare.logger.disableContextMenu();
		$(".btn_login.create").click(function(){
			$(".layer_pop").css("display","block");
			$("body").append("<div class='dim'></div>");
		});
		$(".btn_pop_close").click(function(){ 
			$(".layer_pop").css("display","none");
			$("div").remove(".dim");
		});
		// register_user_code.hide();
	};
	
	scwin.onpageunload = function() {
		
	};

	scwin.btn_create_user_onclick =  function(){

		var data = {};

		data.email = register_user_id.getValue();

		if(scwin.checkData(data)){

		    scwin.ajaxCreateUser(data);

		}


	};

	scwin.btn_back_to_login_onclick =  function(){

		$p.url("/login.xml");

	};

	// checkData function 추가
	scwin.checkData = function(data){

		// 이메일, 이름, password, confirm password
		var user_email = register_user_id.getValue();


		// domain >> 도메인 없을시 대비 해야함..

		if(common.isEmptyStr(user_email)){
			var message = common.getLabel("lbl_user_password_send_email_blank");
			alert(message);
			scwin.check_user_emailYN = false;
			return false;
		}


		if(!scwin.check_user_emailYN){
			var message = common.getLabel("lbl_auth_email");
			alert(message);
			return false;
		}


	    return true;
	};

	// ajax create user function 추가

	scwin.step1_btn_check_email_onclick = function(e){

		var email = register_email.getValue();
		var user_login_id = register_user_id.getValue();

		// if(scwin.checkDataProjectName()){
		if(common.isEmptyStr(user_login_id)){
			var message = common.getLabel("lbl_check_blank_id");
			alert(message);
			return false;
		}

		if(common.isEmptyStr(email)){
			var message = common.getLabel("lbl_email_whitespace");
			alert(message);
			return false;
		}

		// 추가 validation 처리 추가 하기


		scwin.select_user_password_reset_email(email, user_login_id);

		// scwin.send_email_code(email);

	};

	scwin.select_user_password_reset_email = function(user_email, user_login_id){

		var data = {};

		data.user_login_id = user_login_id;
		data.email = user_email;

		var options = {};

		// check userid controller 추가
		options.action = "/manager/account/signUp/resetPassword";
		options.mode = "asynchronous";
		options.mediatype = "application/json";
		options.requestData = JSON.stringify(data);
		options.method = "POST";

		options.success = function (e) {

			if(e.responseStatusCode === 200 || e.responseStatusCode === 201){
				var data = e.responseJSON;
			    if (data != null) {

			        if(data[0].checkPassword == "fail_email"){
						var message = common.getLabel("lbl_not_exist_whive_email");
			            alert(message);
			            scwin.check_user_emailYN = false;
			        }else if(data[0].checkPassword == "success_email"){
						var message = common.getLabel("lbl_user_password_send_email_temporary");
			            alert(message);
			            scwin.check_user_emailYN = true;
						$p.url("/login.xml");
			        }else if(data[0].checkPassword == "fail_id"){
						var message = common.getLabel("lbl_user_password_send_email_notExist_id");
						alert(message);
						scwin.check_user_emailYN = false;
					}else {

					}

						//alert(" 해당 이메일이 존재 합니다.");
			    }
			}else {
				// console.log(e);
			}


		};

		options.error = function (e) {
			// console.log(e);
			if(e.responseStatusCode == 400){

				// console.log(e);
				alert("\n"+"message:"+e.responseText+"\n");
				// scwin.build_project_name_yn = true;
				scwin.check_user_emailYN = true;
			} else if(e.responseStatusCode == 500){
				// alert(" 해당 이메일은 사용 가능 합니다.");
				alert("\n"+"message:"+e.responseText+"\n");
				// scwin.build_project_name_yn = true;
				scwin.check_user_emailYN = true;
			}else {
				alert("\n"+"message:"+e.responseText+"\n");
			}

		};

		$p.ajax( options );

	};

	]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
    	<xf:group class="login_wrap" id="" style="">
    		<xf:group class="login_content reg" id="" style="">
    			<w2:textbox class="form_name" id="" label="" useLocale="true" localeRef="lbl_user_password_send_email_settingPw"
    				style="" tagname="h2">
    			</w2:textbox>
    			<xf:group class="form_wrap" id="" style="">
    				<xf:group class="" id="" style="" tagname="ul">
    					<xf:group class="" id="" style="" tagname="li">
    						<w2:textbox class="form_name" id="" label="" style="" useLocale="true" localeRef="lbl_id"></w2:textbox>
							<xf:group class="ipt_box">
								<xf:input adjustMaxLength="false" id="register_user_id" style=""></xf:input>
<!--								<xf:trigger id="btn_manager_user_email_check" style="" class="btn_cm" type="button" ev:onclick="scwin.step1_btn_check_email_onclick">-->
<!--									<xf:label><![CDATA[인증]]></xf:label>-->
<!--								</xf:trigger>-->
							</xf:group>
    					</xf:group>
						<xf:group class="" id="" style="" tagname="li">
							<w2:textbox class="form_name" id="" label="" style="" useLocale="true" localeRef="lbl_user_password_send_email_email"></w2:textbox>
							<xf:group class="ipt_box">
								<xf:input adjustMaxLength="false" id="register_email" style=""></xf:input>
								<!--								<xf:trigger id="btn_manager_user_email_check" style="" class="btn_cm" type="button" ev:onclick="scwin.step1_btn_check_email_onclick">-->
								<!--									<xf:label><![CDATA[인증]]></xf:label>-->
								<!--								</xf:trigger>-->
							</xf:group>
						</xf:group>
					</xf:group>
    			</xf:group>
    			<xf:group class="fr_btn" id="" style="">
    				<w2:anchor class="btn_login type1" ev:onclick="scwin.step1_btn_check_email_onclick" href="" id="" outerDiv="false" style=""
							   useLocale="true" localeRef="lbl_user_password_send_email_send">
    					<xf:label><![CDATA[]]></xf:label>
    				</w2:anchor>
    				<w2:anchor class="btn_login type2" ev:onclick="scwin.btn_back_to_login_onclick" href="" id="" outerDiv="false" style=""
							   useLocale="true" localeRef="lbl_cancel">
    					<xf:label><![CDATA[]]></xf:label>
    				</w2:anchor>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
